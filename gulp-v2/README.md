# Стартовый проект с gulp и webpack
## Парадигма
- разметка в [pug](https://pugjs.org/), стилизация [Sass](http://sass-lang.com/).
- Каждый БЭМ-блок в своей папке внутри `src/blocks/`. Один БЭМ-блок — один pug-файл, один scss-файл, один js-файл.
- Есть папка components, с различными миксинами, глобальными блоками(btn, radio, checkbox, selectmenu...)
- Список использованных в проекте доп. файлов — в `config.js`.
- Есть глобальные файлы: стилевые (стили печати), js, шрифты, картинки.
- Список pug-примесей `src/pug/mixins.pug` генерируется автоматически, содержит `include` существующих pug-файлов в `src/components`.
- Диспетчер подключения стилей `src/scss/style.scss` генерируется автоматически, содержит импорты стилевых файлов находящихся в `src/blocks` и `src/components`, и импорты доп. файлов(`config.js`).
- Входная точка обработки js (`src/js/entry.js`) генерируется автоматически, содержит `require` js-файлов находящихся в `src/blocks`, `src/components`, и доп. файлы(`config.js`).

## Установка
Требуются установленный [git](https://git-scm.com/) и [Node.js (LTS)](https://nodejs.org/en/).
- Установить зависимости проекта: `npm i`

## Команды
```bash
npm start                                # запуск сервера разработки
npm build, npm run-script build          # сборка без запуска сервера разработки
```
## Структура

```bash
dist/                 # Папка сборки
src/                  # Исходники
  blocks/             # Блоки
  components/         # миксины
  img/                # Изображения
    sprite-svg/svg    # Спрайтовые свг иконки
  js/                 # Служебные скрипты
  libs/               # Бибилотека файлов, не входят в сборку
  pages/              # Страницы проекта
  pug/                # Служебные pug-файлы
  scss/               # Служебные стилевые файлы
  static/             # Статичные файлы, отправляются в dist/
    favicon/          # Фавиконки
    fonts/            # Шрифты
    js/page-switcher  # Скрипт для создания меню со всеми страницами сайта
    js/rs             # Скрипты с ajax или которые понадобятся бэку
```

## Как это работает
При `npm start` запускается дефолтная задача gulp:
1. Очищается папка сборки (`dist/`).
2. Записывается файл `src/pug/mixins.pug` со всеми pug-миксинами из `src/components/`.
3. Компилируются файлы страниц (`src/pages/**/*.pug`).
4. Записывается диспетчер подключения стилей `src/scss/style.scss`, в котором:
    - Импорты файлов из секции `addStyleBefore` файла `config.js`. По умолчанию — шрифты, SCSS-переменные, примеси, reset стилей, глобальные стили.
    - Импорты scss-файлов из `src/components/`.
    - Импорты scss-файлов из `src/blocks/`.
    - Импорты файлов из секции `addStyleAfter` файла `config.js`.
5. Записывается диспетчер подключений скриптов `src/js/entry.js`, в котором:
    - `require` файлов из секции `addJsBefore` файла `config.js`.
    - `require` js-файлов из `src/components/`.
    - `require` js-файлов из `src/blocks/`.
    - `require` файлов из секции `addJsAfter` файла `config.js`.
6. Компилируются и обрабатываются PostCSS-ом стили (`src/scss/style.scss`).
7. Javascript (`src/js/entry.js`) собирается webpack-ом.
8. Генерируется svg-спрайт из `src/img/sprite-svg/`(если используется), в папку сборки копируются картинки из секции `addAssets` файла `config.js`(`src/img/`).
9. Запускается локальный сервер и слежение за файлами для пересборки.

## Блоки

### `src/blocks/`

Возможное содержимое блока:

```bash
demo-block/        # Папка блока.
  demo-block.pug   # Разметка.
  demo-block.scss  # Стилевой файл этого блока.
  demo-block.js    # js-файл блока.
```

### `src/components`

**!!!Все `pug`-файлы - миксины!!!**

Все `pug`-файлы из этой папки подключаются в шапку pug-шаблона каждой страницы, а значит все `pug`-файлы - миксины. Если добавить сюда `pug` с обычной версткой, то на странице она появится в самом верху, что будет ошибкой.

Здесь лежат кнопки, чекбоксы, хлебные крошки, селектменю, модалки и т.д.

Возможное содержимое блока:

```bash
checkbox/        # Папка блока.
  checkbox.pug   # Разметка(миксин).
  checkbox.scss  # Стилевой файл этого блока.
  checkbox.js    # js-файл блока.
```

Также сюда можно выносить такие файлы как `btn`, `form`, `modal` в которых нет `pug`-миксинов, а значит и pug-файлов:
```bash
btn/        # Папка блока
 btn.scss   # Стилевой файл этого блока.
```
```bash
modal/        # Папка блока
 modal.scss   # Стилевой файл этого блока.
 modal.js     # js-файл блока.
```

## Сторонние npm-модули

Если нужно взять в сборку сторонний модуль, то после его установки:

1. Прописать `require` в js-файле проектного блока (там же писать всё, что касается работы с этим модулем). Если сторонний модуль нужен без привязки к какому-либо проектому блоку, прописать `require` в `src/js/global-scripts.js`.
2. Если нужно брать в сборку стилевые файлы модуля, прописать их в секции `addStyleBefore` файла `config.js` (пример в файле).
3. Если нужно брать в сборку дополнительные файлы модуля, то нужно их добавить в папку `src/static/`, а оттуда они попадут в dist/.

## Разметка

Используется [pug](https://pugjs.org/api/getting-started.html).

Все страницы (см. `src/pages/index.pug`) являются расширениями шаблонов из `src/pug` (см. [наследование шаблонов](https://pugjs.org/language/inheritance.html)), в страницах описывается только содержимое «шапки», «подвала» и контентной области (см. [блоки](https://pugjs.org/language/inheritance.html#block-append-prepend)).

Из папки `src/blocks/` подключаем `pug`-файлы в `src/pages/страница.pug`

Каждый блок в `src/components/` может содержать одноимённый pug-файл с примесью, который при старте сервера разработки будет взят includ-ом в файл `src/pug/mixins.pug` и подключен в шапку шаблона(`src/pug/layout.pug`).

## Стили

Диспетчер подключений (`src/scss/style.scss`) формируется автоматически при старте сервера разработки.
Очередность подключения стилей:
- `config.js#addStyleBefore`;
- `src/components`;
- `src/blocks`;
- `config.js#addStyleAfter`;

Каждый блок (в `src/blocks/` или в `src/components/`) может содержать одноимённый scss-файл со стилями этого блока.

## Стилевой код-гайд

1. БЭМ-именование: `__` — разделитель элемента, `--` — разделитель модификатора.
2. Один Блок = один стилевой файл.
3. Очередность селекторов:
    - Инклуды примесей
    - Стилевые правила сущности
    - Псевдоселекторы и псевдоэлементы
    - Сторонние вложенные селекторы
    - Элементы блока
    - Модификаторы блока
    - Медиаусловия(в конце файла)
    
## Скрипты

Точка входа (`src/js/entry.js`) формируется автоматически при старте сервера разработки. Точка входа обрабатывается webpack-ом (с babel-loader).

Для глобальных действий предусмотрен `src/js/global-scripts.js` (см. `config.js#addJsBefore` и `config.js#addJsAfter`).

Каждый блок (в `src/blocks/` или в `src/components/`) может содержать одноимённый js-файл.

## Картинки и генерация svg-спрайта

Из файлов `src/img/sprite-svg/` генерируется файл спрайта `src/img/sprite.svg`.

Всё содержимое папки `src/img/`, за исключением папки `src/img/sprite-svg/`(см. `config.js#addAssets`), переносятся в `dist/img/`.

Для вставки на страницу используйте <code>svg &gt; use</code> со ссылками на <code>id</code> символа:

<pre class="code">
<code>svg(width="32", height="32")</code>
<code>  use(xlink:href="img/sprite.svg#check")</code>
</pre>

В данном случае `#check` - имя нашей svg-картинки из svg-спрайта, которую мы добавляли в `src/img/sprite-svg/check.svg`.

`src/img/icons/` - папка для иконок(не идут в svg-спрайт)

## Удобное создание нового блока

```bash
# формат: node create.js ИМЯБЛОКА [доп. расширения через пробел]
node create.js demo-block        # создаст папку блока в `src/blocks`, demo-block.pug, demo-block.scss, demo-block.js 
node create.js demo-block php    # создаст папку блока в `src/blocks`, demo-block.pug, demo-block.scss, demo-block.js и demo-block.php
node create.js demo-block md     # дополнительно создаст внутри блока readme.md
```
Если блок уже существует, файлы не будут затёрты, но создадутся те файлы, которые ещё не существуют.